name: ðŸš€ Build and Release

 

on:

  push:

    tags:

      - 'v*.*.*'  # Triggers on version tags like v1.0.0, v1.2.3, etc.

 

permissions:

  contents: write

 

jobs:

  build:

    name: Build ${{ matrix.os }}

    runs-on: ${{ matrix.os }}

 

    strategy:

      matrix:

        include:

          - os: windows-latest

            artifact_name: StarCitizenCargoShare.exe

            asset_name: StarCitizenCargoShare-Windows.exe

          - os: ubuntu-latest

            artifact_name: StarCitizenCargoShare

            asset_name: StarCitizenCargoShare-Linux

          - os: macos-latest

            artifact_name: StarCitizenCargoShare

            asset_name: StarCitizenCargoShare-macOS

 

    steps:

      - name: â¬¢ Checkout code

        uses: actions/checkout@v4

 

      - name: ðŸ Set up Python

        uses: actions/setup-python@v5

        with:

          python-version: '3.11'

 

      - name: ðŸ“¦ Install dependencies

        run: |

          python -m pip install --upgrade pip

          pip install pyinstaller

 

      - name: ðŸ”¨ Build executable

        run: pyinstaller cargo-share.spec

 

      - name: ðŸ“‹ Verify build (Windows)

        if: matrix.os == 'windows-latest'

        run: |

          if (Test-Path "dist/${{ matrix.artifact_name }}") {

            Write-Host "âœ“ Build successful: dist/${{ matrix.artifact_name }}"

            Get-Item "dist/${{ matrix.artifact_name }}" | Select-Object Name, Length

          } else {

            Write-Error "âœ— Build failed: executable not found"

            exit 1

          }

        shell: pwsh

 

      - name: ðŸ“‹ Verify build (Unix)

        if: matrix.os != 'windows-latest'

        run: |

          if [ -f "dist/${{ matrix.artifact_name }}" ]; then

            echo "âœ“ Build successful: dist/${{ matrix.artifact_name }}"

            ls -lh "dist/${{ matrix.artifact_name }}"

            chmod +x "dist/${{ matrix.artifact_name }}"

          else

            echo "âœ— Build failed: executable not found"

            exit 1

          fi

 

      - name: ðŸ“¤ Upload artifact

        uses: actions/upload-artifact@v4

        with:

          name: ${{ matrix.asset_name }}

          path: dist/${{ matrix.artifact_name }}

          retention-days: 5

 

  release:

    name: ðŸ“¦ Create Release

    needs: build

    runs-on: ubuntu-latest

 

    steps:

      - name: â¬¢ Checkout code

        uses: actions/checkout@v4

 

      - name: ðŸ“¥ Download all artifacts

        uses: actions/download-artifact@v4

        with:

          path: artifacts

 

      - name: ðŸ“‹ Display structure

        run: ls -R artifacts

 

      - name: ðŸ·ï¸ Extract version

        id: version

        run: echo "VERSION=${GITHUB_REF#refs/tags/}" >> $GITHUB_OUTPUT

 

      - name: ðŸ“ Generate release notes

        id: notes

        run: |

          cat > release_notes.md << 'EOF'

          # â¬¢ Star Citizen Cargo Share ${{ steps.version.outputs.VERSION }}

 

          ## ðŸŽ¯ Modern Star Citizen UI

 

          Calculateur de parts cargo avec interface futuriste inspirÃ©e de Star Citizen.

 

          ## ðŸ“¦ Downloads

 

          TÃ©lÃ©chargez la version correspondant Ã  votre systÃ¨me :

 

          - **Windows** : `StarCitizenCargoShare-Windows.exe`

          - **Linux** : `StarCitizenCargoShare-Linux`

          - **macOS** : `StarCitizenCargoShare-macOS`

 

          ## ðŸš€ Installation

 

          ### Windows

          1. TÃ©lÃ©chargez `StarCitizenCargoShare-Windows.exe`

          2. Double-cliquez pour lancer (Windows Defender peut demander confirmation)

 

          ### Linux

          ```bash

          # TÃ©lÃ©chargez StarCitizenCargoShare-Linux

          chmod +x StarCitizenCargoShare-Linux

          ./StarCitizenCargoShare-Linux

          ```

 

          ### macOS

          ```bash

          # TÃ©lÃ©chargez StarCitizenCargoShare-macOS

          chmod +x StarCitizenCargoShare-macOS

          ./StarCitizenCargoShare-macOS

          ```

 

          ## âœ¨ Features

 

          - Interface moderne style Star Citizen (cyan electric, effets lumineux)

          - Calcul Ã©quitable : part collective + part investissement

          - Gestion d'Ã©quipage avec investisseurs et membres

          - Historique dÃ©taillÃ© des 10 derniers runs

          - Panels redimensionnables

          - Rapports de distribution professionnels

 

          ## ðŸŒŒ See you in the 'verse, Commander!

          EOF

 

          cat release_notes.md

 

      - name: ðŸŽ‰ Create GitHub Release

        uses: softprops/action-gh-release@v1

        with:

          name: Star Citizen Cargo Share ${{ steps.version.outputs.VERSION }}

          body_path: release_notes.md

          draft: false

          prerelease: false

          files: |

            artifacts/StarCitizenCargoShare-Windows.exe/StarCitizenCargoShare.exe

            artifacts/StarCitizenCargoShare-Linux/StarCitizenCargoShare

            artifacts/StarCitizenCargoShare-macOS/StarCitizenCargoShare

          fail_on_unmatched_files: true

        env:

          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

 

      - name: âœ… Release created

        run: |

          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"

          echo "â•‘          â¬¢ RELEASE CREATED SUCCESSFULLY â¬¢                â•‘"

          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          echo ""

          echo "Version: ${{ steps.version.outputs.VERSION }}"

          echo "URL: https://github.com/${{ github.repository }}/releases/tag/${{ steps.version.outputs.VERSION }}"
